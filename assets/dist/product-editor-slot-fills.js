(()=>{"use strict";const e=window.React,t=window.wc.productEditor,n=window.wp.i18n,i=window.wp.data,o=window.wp.plugins;function a(e,t){return t>0&&(e%t!=0||0===e)}function r(e){return parseFloat(e||"0")}function m(e,t){const n=e.map((e=>t[e.key]?{...e,value:t[e.key]}:e));for(const[e,i]of Object.entries(t))n.some((t=>t.key===e))||n.push({key:e,value:i});return n}function u(e,t){return e.find((e=>e.key===t))?.value}const s=window.wp.coreData;function l(){const{hasCategoryGroupOf:o,categoryGroupOf:l}=function(e){const t="product",n=(0,s.useEntityId)("postType",t),o=n,{selectedCategories:a,groupOf:r}=(0,i.useSelect)((e=>{const{getEditedEntityRecord:n}=e("core"),{meta_data:i}=n("postType",t,o),{categories:a}=n("postType",t,o),r=i?.find((e=>"group_of_quantity"===e.key))?.value;return{groupOf:r,selectedCategories:e("core").getEntityRecords("taxonomy","product_cat",{include:a?.map((e=>e.id))})||[]}}),[o]),m=Math.min(...a.filter((e=>""!==e.meta?.group_of_quantity)).map((e=>parseFloat(e.meta?.group_of_quantity||"0")))),u=Boolean(m&&m!==1/0),l=Boolean(u&&!r);return{groupOf:r&&String(r||"")||l&&String(m)||"1",isCategoryGroupOf:l,hasCategoryGroupOf:u,categoryGroupOf:String(m)}}(),{createErrorNotice:c}=(0,i.useDispatch)("core/notices"),[p]=(0,t.__experimentalUseProductEntityProp)("meta_data.allow_combination"),d=({value:e,minOrMax:t,selection:i,onChange:s,onClose:p})=>{const d=i.map((i=>{const m=u(i.meta_data,"min"===t?"maximum_allowed_quantity":"minimum_allowed_quantity");if(m){const o=r(m);if("min"===t&&e>o)return(0,n.sprintf)(
// translators: %s is variation name
(0,n.__)("⛔️ %s: Min. quantity must be lower than max. quantity","woocommerce-min-max-quantities"),i.name);if("max"===t&&e<o)return(0,n.sprintf)(
// translators: %s is variation name
(0,n.__)("⛔️ %s: Max. quantity must be higher than min. quantity","woocommerce-min-max-quantities"),i.name)}return!!a(e,r(u(i.meta_data,"group_of_quantity")||o?l:"1"))&&(0,n.sprintf)(
// translators: %s is variation name
(0,n.__)("⛔️ %s: This quantity is not a multiple of the existing group of quantity.\nFor more details, edit each variation individually and review quantity rules.","woocommerce-min-max-quantities"),i.name)})).filter(Boolean);d.length>0?c(d[0]):(s(i.map((n=>({id:n.id,meta_data:m(n.meta_data,{["min"===t?"minimum_allowed_quantity":"maximum_allowed_quantity"]:String(e),minmax_override_main_product:"yes"})})))),p())};return"yes"!==p&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)(t.__experimentalVariationQuickUpdateMenuItem,{group:"inventory",supportsMultipleSelection:!0,onClick:({selection:e,onChange:t,onClose:i})=>{const o=window.prompt((0,n.__)("Please enter the Sell in groups of value","woocommerce-min-max-quantities"),"");if(null===o||""===o||isNaN(r(o)))return;const s=r(o),l=e.map((e=>{const t=u(e.meta_data,"minimum_allowed_quantity");if(t&&a(r(t),s))return(0,n.sprintf)(
// translators: %s is the variation name
(0,n.__)("⛔️ %s: Min. quantity is not a multiple of this group of quantity.\nFor more details, edit each variation individually and review quantity rules.","woocommerce-min-max-quantities"),e.name);const i=u(e.meta_data,"maximum_allowed_quantity");return!(!i||!a(r(i),s))&&(0,n.sprintf)(
// translators: %s is the variation name
(0,n.__)("⛔️ %s: Max. quantity is not a multiple of this group of quantity.\nFor more details, edit each variation individually and review quantity rules..","woocommerce-min-max-quantities"),e.name)})).filter(Boolean);l.length>0?c(l[0]):(t(e.map((e=>({id:e.id,meta_data:m(e.meta_data,{group_of_quantity:String(o),minmax_override_main_product:"yes"})})))),i())}},(0,n.__)("Sell in groups of","woocommerce-min-max-quantities")),(0,e.createElement)(t.__experimentalVariationQuickUpdateMenuItem,{group:"inventory",supportsMultipleSelection:!0,onClick:({selection:e,onChange:t,onClose:i})=>{const o=window.prompt((0,n.__)("Please enter the minimum quantity","woocommerce-min-max-quantities"),"");if(null===o||""===o||isNaN(r(o)))return;const a=r(o);d({value:a,minOrMax:"min",selection:e,onChange:t,onClose:i})}},(0,n.__)("Set minimum quantity","woocommerce-min-max-quantities")),(0,e.createElement)(t.__experimentalVariationQuickUpdateMenuItem,{group:"inventory",supportsMultipleSelection:!0,onClick:({selection:e,onChange:t,onClose:i})=>{const o=window.prompt((0,n.__)("Please enter the maximum quantity","woocommerce-min-max-quantities"),"");if(null===o||""===o||isNaN(r(o)))return;const a=r(o);d({value:a,minOrMax:"max",selection:e,onChange:t,onClose:i})}},(0,n.__)("Set maximum quantity","woocommerce-min-max-quantities")))}(0,o.registerPlugin)("woocommerce-min-max-product-editor-slotfills",{scope:"woocommerce-product-block-editor",render:()=>(0,e.createElement)(l,null)})})();