(()=>{"use strict";const t=window.wp.blocks,e=window.React,n=window.wc.blockTemplates,i=window.wc.productEditor,a=window.wp.i18n;function o(t,e){return e>0&&(t%e!=0||0===t)}function r(t){return parseFloat(t||"0")}function u(t){return t||""}const m=window.wp.data,s=window.wp.coreData,p=window.wp.element;const c=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"woocommerce-min-max/variation-min-quantity-field","version":"0.1.0","title":"Minimum Quantity","category":"widgets","icon":"flag","description":"Minimum Quantity","attributes":{"label":{"type":"string","__experimentalRole":"content"},"tooltip":{"type":"string","__experimentalRole":"content"}},"supports":{"html":false,"inserter":false},"textdomain":"woocommerce-min-max-quantities","editorScript":"file:./index.js","usesContext":["postType"]}');(0,t.registerBlockType)(c,{edit:function({attributes:t,context:{postType:c}}){const l=(0,n.useWooBlockProps)(t),[d]=(0,i.__experimentalUseProductEntityProp)("parent_id",{postType:c}),{groupOf:_,isCategoryGroupOf:y}=function(t){const e=t?.postType||"product",n=(0,s.useEntityId)("postType",e),i=t?.useParentCategories?t?.parentId:n,{selectedCategories:a,groupOf:o}=(0,m.useSelect)((a=>{const{getEditedEntityRecord:o}=a("core"),{meta_data:r}=o("postType",e,i),{categories:u}=t?.useParentCategories?o("postType","product",t?.parentId):o("postType",e,i),m=r?.find((t=>"group_of_quantity"===t.key))?.value;return{groupOf:t?.useParentCategories?o("postType","product_variation",n).meta_data?.find((t=>"group_of_quantity"===t.key))?.value:m,selectedCategories:a("core").getEntityRecords("taxonomy","product_cat",{include:u?.map((t=>t.id))})||[]}}),[i]),r=Math.min(...a.filter((t=>""!==t.meta?.group_of_quantity)).map((t=>parseFloat(t.meta?.group_of_quantity||"0")))),u=Boolean(r&&r!==1/0),p=Boolean(u&&!o);return{groupOf:o&&String(o||"")||p&&String(r)||"1",isCategoryGroupOf:p,hasCategoryGroupOf:u,categoryGroupOf:String(r)}}({parentId:d,postType:c,useParentCategories:!0}),f=function(t,e,n){const[m,s]=(0,i.__experimentalUseProductEntityProp)("meta_data.maximum_allowed_quantity",{postType:t}),[c,l]=(0,i.__experimentalUseProductEntityProp)("meta_data.minimum_allowed_quantity",{postType:t}),{error:d}=(0,i.useValidation)("meta_data.minimum_allowed_quantity_on_save",(async function(){if(r(c)<0)return(0,a.sprintf)(
// translators: %d is the minimum value of the number input.
// translators: %d is the minimum value of the number input.
(0,a.__)("Value must be greater than or equal to %d","woocommerce-min-max-quantities"),0)}),[c]),{error:_,validate:y}=(0,i.useValidation)("meta_data.minimum_allowed_quantity_on_change",(async function(t,i){const u="string"==typeof i?.maximumQuantity?i.maximumQuantity:m;return function(t,e,n,i){if("min"===i?t:e)return t&&e&&r(t)>r(e)?"min"===i?(0,a.sprintf)(
// translators: %d is the value of the max quantity.
// translators: %d is the value of the max quantity.
(0,a.__)("This must be lower than or equal to %d (your max. quantity).","woocommerce-min-max-quantities"),r(e)):(0,a.sprintf)(
// translators: %d is the value of the min quantity.
// translators: %d is the value of the min quantity.
(0,a.__)("This must be higher than or equal to %d (your min. quantity).","woocommerce-min-max-quantities"),r(t)):function(t,e){if(t&&o(r(t),r(e)))return(0,a.sprintf)(
// translators: %d is the value of the groupOf quantity input.
// translators: %d is the value of the groupOf quantity input.
(0,a.__)("Please enter an integer multiple of %d","woocommerce-min-max-quantities"),e)}("min"===i?t:e,n)}("string"==typeof i?.minimumQuantity?i.minimumQuantity:c,u,e,n)}),[m,c,e]),f=function(t,e){const{update:n}=(0,i.__experimentalUseProductMetadata)(e);return(e,i,a,u)=>{const m=[];let s=e;(i&&"minimum_allowed_quantity"===u?r(s)>r(i):r(s)<r(i))?(s=i,m.push({key:u,value:i})):o(r(e),r(a))&&(s=function(t,e){const n=Math.ceil(t/e)*e,i=Math.floor(t/e)*e;return Math.abs(n-t)>Math.abs(i-t)?i:n}(r(e),r(a)).toString(),m.push({key:u,value:s})),m.length&&n(m),t({minimumQuantity:"minimum_allowed_quantity"===u?s:i,maximumQuantity:"maximum_allowed_quantity"===u?s:i})}}(y,{postType:t});return(0,p.useEffect)((()=>{y()}),[e]),{onBlur:()=>{c&&f(c,m,e,"minimum_allowed_quantity")},error:_||d,value:u(c),onChange:t=>{l(t),y({minimumQuantity:t})},step:r(e)}}(c,_,"min"),w=function(t,e){const[n]=(0,i.__experimentalUseProductEntityProp)("meta_data.minmax_override_main_product",{postType:t}),[a]=(0,i.__experimentalUseProductEntityProp)("parent_id",{postType:t}),{metadata:o,isLoading:r}=(0,i.__experimentalUseProductMetadata)({id:a}),[m]=(0,i.__experimentalUseProductEntityProp)("meta_data.minimum_allowed_quantity",{postType:t}),[s]=(0,i.__experimentalUseProductEntityProp)("meta_data.maximum_allowed_quantity",{postType:t}),p=!n||"no"===n||"yes"===o?.allow_combination;let c="";return r||(c=u(p?o?.minimum_allowed_quantity:m)),{disabled:p,value:c,...r?{placeholder:""}:{}}}(c);return(0,e.createElement)("div",{...l},(0,e.createElement)(i.__experimentalNumberControl,{...t,...f,placeholder:y?(0,a.sprintf)(
// translators: %d is the value of the category group of quantity.
// translators: %d is the value of the category group of quantity.
(0,a.__)("%d (category default)","woocommerce-min-max-quantities"),r(_)):(0,a.sprintf)(
// translators: %d is the value of the category group of quantity.
// translators: %d is the value of the category group of quantity.
(0,a.__)("%d (default)","woocommerce-min-max-quantities"),r(_)),...w}))}})})();