(()=>{"use strict";const t=window.wp.blocks,e=window.React,i=window.wc.blockTemplates,a=window.wc.productEditor,n=window.wp.i18n;function o(t,e){return e>0&&(t%e!=0||0===t)}function m(t){return parseFloat(t||"0")}function r(t){return t||""}function u(t,e,i,a){if("min"===a?t:e)return t&&e&&m(t)>m(e)?"min"===a?(0,n.sprintf)(
// translators: %d is the value of the max quantity.
(0,n.__)("This must be lower than or equal to %d (your max. quantity).","woocommerce-min-max-quantities"),m(e)):(0,n.sprintf)(
// translators: %d is the value of the min quantity.
(0,n.__)("This must be higher than or equal to %d (your min. quantity).","woocommerce-min-max-quantities"),m(t)):function(t,e){if(t&&o(m(t),m(e)))return(0,n.sprintf)(
// translators: %d is the value of the groupOf quantity input.
(0,n.__)("Please enter an integer multiple of %d","woocommerce-min-max-quantities"),e)}("min"===a?t:e,i)}const s=window.wp.data,c=window.wp.coreData;function l(t,e){const{update:i}=(0,a.__experimentalUseProductMetadata)(e);return(e,a,n,r)=>{const u=[];let s=e;(a&&"minimum_allowed_quantity"===r?m(s)>m(a):m(s)<m(a))?(s=a,u.push({key:r,value:a})):o(m(e),m(n))&&(s=function(t,e){const i=Math.ceil(t/e)*e,a=Math.floor(t/e)*e;return Math.abs(i-t)>Math.abs(a-t)?a:i}(m(e),m(n)).toString(),u.push({key:r,value:s})),u.length&&i(u),t({minimumQuantity:"minimum_allowed_quantity"===r?s:a,maximumQuantity:"maximum_allowed_quantity"===r?s:a})}}const p=window.wp.element,d=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"woocommerce-min-max/max-quantity-field","version":"0.1.0","title":"Maximum Quantity","category":"widgets","icon":"flag","description":"Maximum Quantity","attributes":{"label":{"type":"string","__experimentalRole":"content"}},"supports":{"html":false,"inserter":false},"textdomain":"woocommerce-min-max-quantities","editorScript":"file:./index.js"}');(0,t.registerBlockType)(d,{edit:function({attributes:t,context:{postType:o}}){const d=(0,i.useWooBlockProps)(t),[y,_]=(0,a.__experimentalUseProductEntityProp)("meta_data.maximum_allowed_quantity",{postType:o}),[f]=(0,a.__experimentalUseProductEntityProp)("meta_data.minimum_allowed_quantity",{postType:o}),{groupOf:w}=function(t){const e="product",i=(0,c.useEntityId)("postType",e),a=i,{selectedCategories:n,groupOf:o}=(0,s.useSelect)((t=>{const{getEditedEntityRecord:i}=t("core"),{meta_data:n}=i("postType",e,a),{categories:o}=i("postType",e,a),m=n?.find((t=>"group_of_quantity"===t.key))?.value;return{groupOf:m,selectedCategories:t("core").getEntityRecords("taxonomy","product_cat",{include:o?.map((t=>t.id))})||[]}}),[a]),m=Math.min(...n.filter((t=>""!==t.meta?.group_of_quantity)).map((t=>parseFloat(t.meta?.group_of_quantity||"0")))),r=Boolean(m&&m!==1/0),u=Boolean(r&&!o);return{groupOf:o&&String(o||"")||u&&String(m)||"1",isCategoryGroupOf:u,hasCategoryGroupOf:r,categoryGroupOf:String(m)}}(),{error:g,validate:x}=(0,a.useValidation)("meta_data.maximum_allowed_quantity_on_change",(async function(t,e){const i="string"==typeof e?.maximumQuantity?e.maximumQuantity:y;return u("string"==typeof e?.minimumQuantity?e.minimumQuantity:f,i,w,"max")}),[y,f,w]),q=(l(x),function(t,e,i){const[o,s]=(0,a.__experimentalUseProductEntityProp)("meta_data.maximum_allowed_quantity",{postType:t}),[c,d]=(0,a.__experimentalUseProductEntityProp)("meta_data.minimum_allowed_quantity",{postType:t}),{error:y}=(0,a.useValidation)("meta_data.minimum_allowed_quantity_on_save",(async function(){if(m(o)<0)return(0,n.sprintf)(
// translators: %d is the minimum value of the number input.
(0,n.__)("Value must be greater than or equal to %d","woocommerce-min-max-quantities"),0)}),[o]),{error:_,validate:f}=(0,a.useValidation)("meta_data.maximum_allowed_quantity_on_change",(async function(t,a){const n="string"==typeof a?.maximumQuantity?a.maximumQuantity:o;return u("string"==typeof a?.minimumQuantity?a.minimumQuantity:c,n,e,i)}),[o,c,e]),w=l(f,{postType:t});return(0,p.useEffect)((()=>{f()}),[e]),{onBlur:()=>{o&&w(o,c,e,"maximum_allowed_quantity")},error:_||y,value:r(o),onChange:t=>{s(t),f({maximumQuantity:t})},step:m(e)}}(o,w,"max"));return(0,e.createElement)("div",{...d},(0,e.createElement)(a.__experimentalNumberControl,{...t,...q,placeholder:(0,n.__)("No limit","woocommerce-min-max-quantities"),tooltip:(0,n.__)("Enter a maximum quantity customers can buy in a single order. This is particularly useful for items that have limited quantity, like art or handmade goods.","woocommerce-min-max-quantities")}))}})})();