(()=>{"use strict";const t=window.wp.blocks,e=window.React,a=window.wc.blockTemplates,n=window.wc.productEditor,o=window.wp.data,i=window.wp.coreData,r=window.wp.element,u=window.wp.i18n;function m(t,e){return e>0&&(t%e!=0||0===t)}function s(t){return parseFloat(t||"0")}function p(t){return t||""}const l=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"woocommerce-min-max/variation-max-quantity-field","version":"0.1.0","title":"Maximum Quantity","category":"widgets","icon":"flag","description":"Maximum Quantity","attributes":{"label":{"type":"string","__experimentalRole":"content"},"placeholder":{"type":"string","__experimentalRole":"content"},"tooltip":{"type":"string","__experimentalRole":"content"}},"supports":{"html":false,"inserter":false},"textdomain":"woocommerce-min-max-quantities","editorScript":"file:./index.js","usesContext":["postType"]}');(0,t.registerBlockType)(l,{edit:function({attributes:t,context:{postType:l}}){const c=(0,a.useWooBlockProps)(t),[d]=(0,n.__experimentalUseProductEntityProp)("parent_id",{postType:l}),{groupOf:_}=function(t){const e=t?.postType||"product",a=(0,i.useEntityId)("postType",e),n=t?.useParentCategories?t?.parentId:a,{selectedCategories:r,groupOf:u}=(0,o.useSelect)((o=>{const{getEditedEntityRecord:i}=o("core"),{meta_data:r}=i("postType",e,n),{categories:u}=t?.useParentCategories?i("postType","product",t?.parentId):i("postType",e,n),m=r?.find((t=>"group_of_quantity"===t.key))?.value;return{groupOf:t?.useParentCategories?i("postType","product_variation",a).meta_data?.find((t=>"group_of_quantity"===t.key))?.value:m,selectedCategories:o("core").getEntityRecords("taxonomy","product_cat",{include:u?.map((t=>t.id))})||[]}}),[n]),m=Math.min(...r.filter((t=>""!==t.meta?.group_of_quantity)).map((t=>parseFloat(t.meta?.group_of_quantity||"0")))),s=Boolean(m&&m!==1/0),p=Boolean(s&&!u);return{groupOf:u&&String(u||"")||p&&String(m)||"1",isCategoryGroupOf:p,hasCategoryGroupOf:s,categoryGroupOf:String(m)}}({parentId:d,postType:l,useParentCategories:!0}),y=function(t,e,a){const[o,i]=(0,n.__experimentalUseProductEntityProp)("meta_data.maximum_allowed_quantity",{postType:t}),[l,c]=(0,n.__experimentalUseProductEntityProp)("meta_data.minimum_allowed_quantity",{postType:t}),{error:d}=(0,n.useValidation)("meta_data.minimum_allowed_quantity_on_save",(async function(){if(s(o)<0)return(0,u.sprintf)(
// translators: %d is the minimum value of the number input.
// translators: %d is the minimum value of the number input.
(0,u.__)("Value must be greater than or equal to %d","woocommerce-min-max-quantities"),0)}),[o]),{error:_,validate:y}=(0,n.useValidation)("meta_data.maximum_allowed_quantity_on_change",(async function(t,n){const i="string"==typeof n?.maximumQuantity?n.maximumQuantity:o;return function(t,e,a,n){if("min"===n?t:e)return t&&e&&s(t)>s(e)?"min"===n?(0,u.sprintf)(
// translators: %d is the value of the max quantity.
// translators: %d is the value of the max quantity.
(0,u.__)("This must be lower than or equal to %d (your max. quantity).","woocommerce-min-max-quantities"),s(e)):(0,u.sprintf)(
// translators: %d is the value of the min quantity.
// translators: %d is the value of the min quantity.
(0,u.__)("This must be higher than or equal to %d (your min. quantity).","woocommerce-min-max-quantities"),s(t)):function(t,e){if(t&&m(s(t),s(e)))return(0,u.sprintf)(
// translators: %d is the value of the groupOf quantity input.
// translators: %d is the value of the groupOf quantity input.
(0,u.__)("Please enter an integer multiple of %d","woocommerce-min-max-quantities"),e)}("min"===n?t:e,a)}("string"==typeof n?.minimumQuantity?n.minimumQuantity:l,i,e,a)}),[o,l,e]),f=function(t,e){const{update:a}=(0,n.__experimentalUseProductMetadata)(e);return(e,n,o,i)=>{const r=[];let u=e;(n&&"minimum_allowed_quantity"===i?s(u)>s(n):s(u)<s(n))?(u=n,r.push({key:i,value:n})):m(s(e),s(o))&&(u=function(t,e){const a=Math.ceil(t/e)*e,n=Math.floor(t/e)*e;return Math.abs(a-t)>Math.abs(n-t)?n:a}(s(e),s(o)).toString(),r.push({key:i,value:u})),r.length&&a(r),t({minimumQuantity:"minimum_allowed_quantity"===i?u:n,maximumQuantity:"maximum_allowed_quantity"===i?u:n})}}(y,{postType:t});return(0,r.useEffect)((()=>{y()}),[e]),{onBlur:()=>{o&&f(o,l,e,"maximum_allowed_quantity")},error:_||d,value:p(o),onChange:t=>{i(t),y({maximumQuantity:t})},step:s(e)}}(l,_,"max"),f=function(t,e){const[a]=(0,n.__experimentalUseProductEntityProp)("meta_data.minmax_override_main_product",{postType:t}),[o]=(0,n.__experimentalUseProductEntityProp)("parent_id",{postType:t}),{metadata:i,isLoading:r}=(0,n.__experimentalUseProductMetadata)({id:o}),[u]=(0,n.__experimentalUseProductEntityProp)("meta_data.minimum_allowed_quantity",{postType:t}),[m]=(0,n.__experimentalUseProductEntityProp)("meta_data.maximum_allowed_quantity",{postType:t}),s=!a||"no"===a||"yes"===i?.allow_combination;let l="";return r||(l=p(s?i?.maximum_allowed_quantity:m)),{disabled:s,value:l,...r?{placeholder:""}:{}}}(l);return(0,e.createElement)("div",{...c},(0,e.createElement)(n.__experimentalNumberControl,{...t,...y,...f}))}})})();